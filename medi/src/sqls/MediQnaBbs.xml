<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">


 <mapper namespace="MediQnaBbs">
 <!--
	<select resultType="kh.com.a.model.BbsDto" id="getBbsList"> SELECT SEQ, ID,
		REF, STEP, DEPTH, TITLE, CONTENT, WDATE, PARENT, DEL, READCOUNT FROM
		BBS ORDER BY REF DESC, STEP ASC </select>

	디테일가져오기

	<select resultType="kh.com.a.model.BbsDto" id="getBbsDetail"
		parameterType="java.lang.Integer"> SELECT SEQ, ID, REF, STEP, DEPTH, TITLE, CONTENT,
		WDATE, PARENT, DEL, READCOUNT FROM BBS WHERE SEQ=#{seq} </select>

	추가
	<insert id="insertBbs" parameterType="kh.com.a.model.BbsDto"> INSERT INTO BBS(SEQ, ID,
		REF, STEP, DEPTH, TITLE, CONTENT, WDATE, PARENT, DEL, READCOUNT)
		VALUES(SEQ_BBS.NEXTVAL,#{id},(SELECT NVL(MAX(REF), 0)+1 FROM
		BBS),0,0,#{title},#{content},SYSDATE,0,0,0) </insert>

	수정
	<update id="bbsUpdate" parameterType="kh.com.a.model.BbsDto"> UPDATE BBS SET TITLE
		=#{title}, CONTENT =#{content}, WDATE=SYSDATE WHERE SEQ =#{seq}
	</update>

	업데이트
	<update id="bbsDelete" parameterType="kh.com.a.model.BbsDto"> UPDATE BBS SET DEL = 1
		WHERE SEQ=#{seq} </update>

	조회수
	<update id="bbsReadcount" parameterType="kh.com.a.model.BbsDto"> UPDATE BBS SET
		READCOUNT=READCOUNT+1 WHERE SEQ=#{seq} </update>

	댓글업데이트
	<update id="answerUpdate" parameterType="kh.com.a.model.BbsDto"> UPDATE BBS SET
		STEP=STEP+1 WHERE REF=(SELECT REF FROM BBS WHERE SEQ=#{seq}) AND STEP
		> (SELECT STEP FROM BBS WHERE SEQ=#{seq}) </update>

	답글추가
	<insert id="answerInsert" parameterType="kh.com.a.model.BbsDto"> INSERT INTO BBS(SEQ,
		ID, REF, STEP, DEPTH, TITLE, CONTENT, WDATE, PARENT, DEL, READCOUNT)
		VALUES(SEQ_BBS.NEXTVAL,#{id}, (SELECT REF FROM BBS WHERE SEQ=#{seq}),
		(SELECT STEP FROM BBS WHERE SEQ=#{seq})+1, (SELECT DEPTH FROM BBS
		WHERE SEQ=#{seq})+1, #{title}, #{content}, SYSDATE, #{seq}, 0, 0)
	</insert>

	페이징
	<select resultType="kh.com.a.model.BbsDto" id="getBbsPagingList"
		parameterType="kh.com.a.model.BbsParam">
		SELECT SEQ, ID, REF, STEP, DEPTH, TITLE, CONTENT, WDATE, PARENT, DEL,
		READCOUNT FROM (SELECT ROW_NUMBER() OVER(ORDER BY REF DESC, STEP ASC)
		AS RNUM, SEQ, ID, REF, STEP, DEPTH, TITLE, CONTENT, WDATE, PARENT,
		DEL, READCOUNT FROM BBS WHERE 1=1

		<if
			test="s_category != '' and s_category != null and s_keyword != '' and s_keyword != null">

			<if test="s_category == 'title'"> AND TITLE LIKE '%'||#{s_keyword}||'%' </if>

			<if test="s_category == 'contents'"> AND CONTENT LIKE '%'||#{s_keyword}||'%' </if>

		</if>
		) A WHERE RNUM BETWEEN ${start} AND ${end}
	</select>

	데이터 전체갯수 취득
	<select resultType="java.lang.Integer" id="getBbsCount"
		parameterType="kh.com.a.model.BbsParam">
		SELECT NVL(COUNT(*), 0) AS CNT FROM BBS WHERE 1=1

		<if
			test="s_category != '' and s_category != null and s_keyword != '' and s_keyword != null">

			<if test="s_category == 'title'"> AND TITLE LIKE '%'||#{s_keyword}||'%' </if>

			<if test="s_category == 'contents'"> AND CONTENT LIKE '%'||#{s_keyword}||'%' </if>

		</if>

	</select>-->
</mapper> 